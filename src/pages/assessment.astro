---
import { Container, TextSection } from '@components/odyssey-theme';
import Layout from '../layouts/Page.astro';

const seo = {
	title: 'Assessment | NMES for Astronauts',
	description: 'Test your knowledge about NMES and astronaut health',
};
---

<Layout seo={seo}>
	<Container>
		<TextSection narrow>
			<h1 style="text-align: center;">Assessment</h1>
			<p style="text-align: center;">
				Test your understanding of the material presented in this course.
			</p>

      <div class="quiz-container">
        <form id="quiz-form">
          <div class="question">
            <h3>1. What is the primary cause of muscle degradation in space?</h3>
            <label><input type="radio" name="q1" value="a"> Radiation exposure</label>
            <label><input type="radio" name="q1" value="b"> Lack of mechanical loading</label>
            <label><input type="radio" name="q1" value="c"> Poor nutrition</label>
          </div>

          <div class="question">
            <h3>2. Which muscles are most severely affected by microgravity?</h3>
            <label><input type="radio" name="q2" value="a"> Arm muscles</label>
            <label><input type="radio" name="q2" value="b"> Facial muscles</label>
            <label><input type="radio" name="q2" value="c"> Anti-gravity muscles (legs and spine)</label>
          </div>

          <div class="question">
            <h3>3. How does NMES help maintain muscle mass?</h3>
            <label><input type="radio" name="q3" value="a"> By providing electrical impulses to induce contraction</label>
            <label><input type="radio" name="q3" value="b"> By increasing blood flow only</label>
            <label><input type="radio" name="q3" value="c"> By cooling the muscles</label>
          </div>

          <div class="question">
            <h3>4. What is a key advantage of NMES over traditional exercise equipment for spaceflight?</h3>
            <label><input type="radio" name="q4" value="a"> It tastes better</label>
            <label><input type="radio" name="q4" value="b"> Low mass, volume, and power requirements</label>
            <label><input type="radio" name="q4" value="c"> It generates gravity</label>
          </div>

          <div class="question">
            <h3>5. Why is the "passive" nature of NMES beneficial for astronauts?</h3>
            <label><input type="radio" name="q5" value="a"> It allows them to sleep all day</label>
            <label><input type="radio" name="q5" value="b"> It requires no equipment</label>
            <label><input type="radio" name="q5" value="c"> It can be used during other tasks or rest, saving crew time</label>
          </div>

          <button type="submit" id="submit-btn">Submit Answers</button>
        </form>

      </div>
		</TextSection>
	</Container>

  <div id="quiz-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <h2 id="modal-title">Quiz Complete!</h2>
      <p id="modal-message"></p>
      <div id="modal-score" class="score-display"></div>
      <button id="close-modal-btn">Close</button>
    </div>
  </div>
</Layout>

<style>
  .quiz-container {
    background: var(--theme-surface-1);
    padding: 2rem;
    border-radius: var(--theme-shape-radius);
    border: 1px solid var(--theme-surface-2);
  }

  .question {
    margin-bottom: 2rem;
  }

  .question h3 {
    margin-bottom: 1rem;
  }

  .question label {
    display: flex;
    align-items: center;
    padding: 1rem;
    border: 1px solid var(--theme-surface-2);
    border-radius: var(--theme-shape-radius);
    margin-bottom: 0.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .question label:hover {
    background-color: var(--theme-surface-2);
  }

  .question input[type="radio"] {
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid var(--theme-primary);
    border-radius: 50%;
    margin-right: 1rem;
    position: relative;
    outline: none;
    flex-shrink: 0;
  }

  .question input[type="radio"]:checked {
    background-color: var(--theme-primary);
    box-shadow: inset 0 0 0 4px var(--theme-surface-1);
  }

  #submit-btn {
    width: fit-content;
    padding: 0.5rem 1.5rem;
    margin-top: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--theme-primary);
    color: var(--theme-on-primary);
    border: none;
    border-radius: var(--theme-button-border-radius);
    font-weight: 500;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.2s ease;
  }

  #submit-btn:hover {
    background-color: var(--theme-primary-hover);
  }

  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .modal-overlay.visible {
    opacity: 1;
    pointer-events: auto;
  }

  .modal-content {
    background-color: var(--theme-surface-1);
    padding: 2rem;
    border-radius: var(--theme-shape-radius);
    border: 2px solid var(--theme-primary);
    text-align: center;
    max-width: 90%;
    width: 500px;
    transform: scale(0.8);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  }

  .modal-content h2 {
    font-size: 2rem;
    margin-top: 0;
  }

  .modal-overlay.visible .modal-content {
    transform: scale(1);
  }

  .score-display {
    font-size: 3rem;
    font-weight: bold;
    color: var(--theme-primary);
    margin: 1rem 0;
  }

  #close-modal-btn {
    background-color: var(--theme-surface-2);
    color: var(--theme-on-bg);
    border: none;
    padding: 0.5rem 1.5rem;
    border-radius: var(--theme-button-border-radius);
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.2s ease;
  }

  #close-modal-btn:hover {
    background-color: var(--theme-primary);
    color: var(--theme-on-primary);
  }

  .hidden {
    display: none;
  }
</style>

<script>
  const form = document.getElementById('quiz-form') as HTMLFormElement;
  const modal = document.getElementById('quiz-modal');
  const modalTitle = document.getElementById('modal-title');
  const modalMessage = document.getElementById('modal-message');
  const modalScore = document.getElementById('modal-score');
  const closeBtn = document.getElementById('close-modal-btn');

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const answers = {
      q1: 'b',
      q2: 'c',
      q3: 'a',
      q4: 'b',
      q5: 'c'
    };

    let score = 0;
    const formData = new FormData(form);

    for (const [question, answer] of Object.entries(answers)) {
      if (formData.get(question) === answer) {
        score++;
      }
    }

    // Update Modal Content
    modalScore.textContent = `${score}/5`;
    
    if (score === 5) {
      modalTitle.textContent = "Mission Accomplished!";
      modalMessage.textContent = "Perfect score! You are ready for the mission.";
      // Optional: Add confetti logic here if a library was available
    } else if (score >= 3) {
      modalTitle.textContent = "Well Done!";
      modalMessage.textContent = "Good understanding, but room for improvement.";
    } else {
      modalTitle.textContent = "Mission Aborted";
      modalMessage.textContent = "Review the material and try again.";
    }

    // Show Modal
    modal.classList.remove('hidden');
    // Small delay to allow display:block to apply before opacity transition
    setTimeout(() => {
      modal.classList.add('visible');
    }, 10);
  });

  closeBtn.addEventListener('click', () => {
    modal.classList.remove('visible');
    setTimeout(() => {
      modal.classList.add('hidden');
    }, 300); // Wait for transition
  });

  // Close on click outside
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.remove('visible');
      setTimeout(() => {
        modal.classList.add('hidden');
      }, 300);
    }
  });
</script>
