---
import { Container, TextSection } from '@components/odyssey-theme';
import Layout from '../layouts/Page.astro';

const seo = {
	title: 'Simulate | NMES for Astronauts',
	description: 'Visualize the effects of microgravity on muscle tissue over time.',
};
---

<Layout seo={seo}>
	<Container>
		<TextSection narrow>
			<h1>Muscle Atrophy Simulator</h1>
			<p>
				Visualize how a human thigh muscle changes over 6 months in space. Compare the effects of doing nothing, exercising, and using NMES.
			</p>

      <div class="simulator-container">
        <div class="controls">
          <div class="control-group">
            <label for="days">Days in Space: <span id="days-val">0</span></label>
            <input type="range" id="days" min="0" max="180" value="0">
          </div>

          <div class="control-group">
            <label>Countermeasure Strategy:</label>
            <div class="radio-group">
              <label><input type="radio" name="strategy" value="none" checked> None</label>
              <label><input type="radio" name="strategy" value="exercise"> Exercise Only</label>
              <label><input type="radio" name="strategy" value="nmes"> NMES + Exercise</label>
            </div>
          </div>
        </div>

        <div class="visualization">
          <div id="muscle-cross-section" class="muscle-circle">
            <div class="muscle-inner"></div>
            <div class="bone"></div>
          </div>
          <div class="stats">
            <div class="stat">
              <span class="label">Muscle Mass</span>
              <span id="mass-val" class="value">100%</span>
            </div>
            <div class="stat">
              <span class="label">Fat Infiltration</span>
              <span id="fat-val" class="value">0%</span>
            </div>
          </div>
        </div>
        
        <div id="feedback" class="feedback">
          Day 0: Launch day. Muscle health is optimal.
        </div>
      </div>
		</TextSection>
	</Container>
</Layout>

<style>
  .simulator-container {
    border: 2px solid var(--theme-surface-2);
    border-radius: var(--theme-shape-radius);
    padding: 2rem;
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .controls {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .control-group label {
    font-weight: bold;
    display: block;
    margin-bottom: 0.5rem;
  }

  .radio-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .radio-group label {
    font-weight: normal;
    cursor: pointer;
  }

  .visualization {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
    padding: 2rem;
    background: var(--theme-surface-1);
    border-radius: 8px;
  }

  .muscle-circle {
    width: 200px;
    height: 200px;
    background-color: #ffcccc; /* Fat/Skin color */
    border-radius: 50%;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
  }

  .muscle-inner {
    width: 180px;
    height: 180px;
    background-color: #ff6b6b; /* Muscle color */
    border-radius: 50%;
    position: absolute;
    transition: all 0.3s ease;
  }

  .bone {
    width: 40px;
    height: 40px;
    background-color: #f5f5f5;
    border: 2px solid #e0e0e0;
    border-radius: 50%;
    z-index: 10;
  }

  .stats {
    display: flex;
    gap: 2rem;
    width: 100%;
    justify-content: center;
  }

  .stat {
    text-align: center;
  }

  .stat .label {
    display: block;
    font-size: 0.9rem;
    color: #666;
  }

  .stat .value {
    font-size: 1.5rem;
    font-weight: bold;
  }

  .feedback {
    font-style: italic;
    text-align: center;
    min-height: 1.5em;
  }
</style>

<script>
  const daysInput = document.getElementById('days') as HTMLInputElement;
  const daysVal = document.getElementById('days-val');
  const strategyInputs = document.querySelectorAll('input[name="strategy"]');
  const muscleInner = document.querySelector('.muscle-inner') as HTMLElement;
  const massVal = document.getElementById('mass-val');
  const fatVal = document.getElementById('fat-val');
  const feedback = document.getElementById('feedback');

  function update() {
    const days = parseInt(daysInput.value);
    daysVal.textContent = days.toString();
    
    let strategy = 'none';
    strategyInputs.forEach((input) => {
      const radioInput = input as HTMLInputElement;
      if (radioInput.checked) strategy = radioInput.value;
    });

    // Calculate atrophy rate based on strategy
    // None: 30% loss over 180 days (0.16% per day)
    // Exercise: 15% loss over 180 days (0.08% per day)
    // NMES: 5% loss over 180 days (0.02% per day)
    
    let lossRate = 0;
    if (strategy === 'none') lossRate = 0.30;
    else if (strategy === 'exercise') lossRate = 0.15;
    else if (strategy === 'nmes') lossRate = 0.05;

    const currentLoss = (days / 180) * lossRate;
    const massPercentage = 100 - (currentLoss * 100);
    const fatPercentage = currentLoss * 100; // Simplified: fat replaces muscle space

    // Update Visuals
    // Max size is 180px (90% of container). Min size depends on loss.
    // If 30% loss, size becomes 70% of original.
    const originalSize = 180;
    const newSize = originalSize * (massPercentage / 100);
    
    muscleInner.style.width = `${newSize}px`;
    muscleInner.style.height = `${newSize}px`;
    
    // Change color slightly to indicate health
    if (massPercentage < 80) {
      muscleInner.style.backgroundColor = '#ff8787'; // paler red
    } else {
      muscleInner.style.backgroundColor = '#ff6b6b'; // healthy red
    }

    // Update Text
    massVal.textContent = `${massPercentage.toFixed(1)}%`;
    fatVal.textContent = `${fatPercentage.toFixed(1)}%`;

    // Feedback
    if (days === 0) {
      feedback.textContent = "Day 0: Launch day. Muscle health is optimal.";
    } else if (massPercentage < 80) {
      feedback.textContent = "Critical muscle loss detected. Risk of injury high.";
    } else if (massPercentage < 90) {
      feedback.textContent = "Moderate atrophy. Performance may be impacted.";
    } else {
      feedback.textContent = "Muscle mass well-maintained. Mission ready.";
    }
  }

  daysInput.addEventListener('input', update);
  strategyInputs.forEach(input => input.addEventListener('change', update));

  // Initial call
  update();
</script>
